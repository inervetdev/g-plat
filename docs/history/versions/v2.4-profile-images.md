---
title: "v2.4 - 프로필 이미지 시스템"
category: "history"
subcategory: "versions"
tier: 4
status: "released"
last_updated: "2025-11-18"
release_date: "2025-11-18"
related_docs:
  - path: "docs/roadmap/current-phase.md"
    description: "현재 개발 단계"
  - path: "prd.md"
    description: "제품 요구사항 문서"
tags:
  - release
  - v2.4
  - profile-images
  - admin-app
  - phase-3
---

# v2.4 Release Notes - 프로필 이미지 시스템

**릴리스 일자**: 2025년 11월 18일
**Phase**: 3, Week 3
**주요 기능**: 프로필 이미지 & 회사 로고 업로드

---

## 개요

v2.4는 관리자 웹 서비스의 명함 편집 기능을 완성하는 릴리스입니다. 프로필 이미지와 회사 로고를 업로드할 수 있는 기능이 추가되었으며, 모든 테마 카드에 이미지 표시가 적용되었습니다.

## 주요 변경 사항

### 1. 명함 편집 모달 (CardEditModal) 구현 ✅

#### 기능
- 전체 필드 편집 (기본 정보, 연락처, 소셜 링크, 소개)
- **프로필 이미지 & 회사 로고 업로드**
  - Supabase Storage 통합 (card-attachments 버킷)
  - 이미지 미리보기 및 삭제 기능
  - 업로드 진행률 표시
  - 파일 크기 및 형식 검증 (최대 5MB, JPG/PNG/WEBP/GIF)
- React Hook Form + Zod 검증
- 순수 HTML + Tailwind CSS (shadcn/ui 없이)
- 20+ 필드 지원
- 5개 테마 선택

#### 파일 위치
- `admin-app/src/components/CardEditModal.tsx`

### 2. 데이터베이스 스키마 업데이트

#### 새 컬럼 추가
```sql
ALTER TABLE business_cards
ADD COLUMN profile_image_url TEXT;

ALTER TABLE business_cards
ADD COLUMN company_logo_url TEXT;
```

#### 마이그레이션 파일
- 파일명: `20251118_add_profile_company_images.sql` (수동 실행)
- 위치: `react-app/supabase/migrations/`

### 3. 관리자 RLS 정책 수정

#### business_cards RLS 정책
```sql
-- 관리자 업데이트 권한 추가
CREATE POLICY "Admins can update any card"
ON business_cards FOR UPDATE
USING (
  auth.uid() = user_id
  OR EXISTS (
    SELECT 1 FROM admin_users
    WHERE user_id = auth.uid()
  )
);

-- 관리자 조회 권한 추가
CREATE POLICY "Admins can select any card"
ON business_cards FOR SELECT
USING (
  user_id = auth.uid()
  OR EXISTS (
    SELECT 1 FROM admin_users
    WHERE user_id = auth.uid()
  )
);

-- 관리자 삭제 권한 추가
CREATE POLICY "Admins can delete any card"
ON business_cards FOR DELETE
USING (
  auth.uid() = user_id
  OR EXISTS (
    SELECT 1 FROM admin_users
    WHERE user_id = auth.uid()
  )
);
```

#### Storage RLS 정책
```sql
-- 관리자 파일 업로드 권한
CREATE POLICY "Admins can upload any file"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'card-attachments'
  AND (
    (storage.foldername(name))[1] = auth.uid()::text
    OR EXISTS (
      SELECT 1 FROM admin_users
      WHERE user_id = auth.uid()
    )
  )
);

-- 관리자 파일 수정 권한
CREATE POLICY "Admins can update any file"
ON storage.objects FOR UPDATE
USING (
  bucket_id = 'card-attachments'
  AND (
    (storage.foldername(name))[1] = auth.uid()::text
    OR EXISTS (
      SELECT 1 FROM admin_users
      WHERE user_id = auth.uid()
    )
  )
);

-- 관리자 파일 삭제 권한
CREATE POLICY "Admins can delete any file"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'card-attachments'
  AND (
    (storage.foldername(name))[1] = auth.uid()::text
    OR EXISTS (
      SELECT 1 FROM admin_users
      WHERE user_id = auth.uid()
    )
  )
);
```

### 4. 5개 테마 카드 업데이트

모든 테마 카드에 프로필 이미지 표시 기능 추가:
- ✅ TrendyCard.tsx
- ✅ AppleCard.tsx
- ✅ ProfessionalCard.tsx
- ✅ SimpleCard.tsx
- ✅ DefaultCard.tsx

#### 구현 예시 (TrendyCard)
```tsx
{card.profile_image_url && (
  <div className="mb-4 flex justify-center">
    <img
      src={card.profile_image_url}
      alt={card.name}
      className="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg"
    />
  </div>
)}
```

### 5. API 함수 개선

#### updateCard 함수
- 파일: `admin-app/src/lib/api.ts`
- 프로필 이미지 및 회사 로고 URL 업데이트 지원
- 모든 20+ 필드 업데이트 가능

```typescript
export async function updateCard(
  cardId: string,
  updates: Partial<BusinessCard>
): Promise<void> {
  const { data, error } = await supabase
    .from('business_cards')
    .update(updates)
    .eq('id', cardId)

  if (error) throw new Error(error.message)
}
```

## 기술 세부사항

### 이미지 업로드 플로우

1. **파일 선택**: `<input type="file" accept="image/*" />`
2. **검증**: 파일 크기 (최대 5MB) 및 형식 (JPG/PNG/WEBP/GIF)
3. **업로드**: Supabase Storage API (`storage.from('card-attachments').upload()`)
4. **URL 생성**: Public URL 생성 (`getPublicUrl()`)
5. **DB 업데이트**: `business_cards` 테이블 `profile_image_url` 컬럼 업데이트
6. **미리보기**: 업로드된 이미지 즉시 표시

### 파일 저장 경로
```
card-attachments/
└── {user_id}/
    ├── profile-{timestamp}.jpg
    └── logo-{timestamp}.png
```

### 보안 고려사항
- ✅ RLS 정책으로 사용자별 폴더 접근 제어
- ✅ 관리자는 모든 사용자 폴더 접근 가능
- ✅ 파일 크기 제한 (5MB)
- ✅ 허용된 파일 형식만 업로드 가능
- ✅ Public URL은 읽기 전용

## 배포 정보

### 환경
- **React App (react-app/)**: 변경 없음
- **Admin App (admin-app/)**: 업데이트 배포

### 배포 방법
```bash
# 1. Supabase 데이터베이스 마이그레이션 (수동)
cd react-app
npx supabase db execute --file supabase/migrations/20251118_add_profile_company_images.sql --linked

# 2. RLS 정책 업데이트 (Supabase Dashboard에서 수동 실행)

# 3. Admin App 배포 (자동)
cd admin-app
git commit -m "feat: Add profile image and company logo upload"
git push origin main
# Vercel 자동 배포
```

### 검증 사항
- ✅ 프로필 이미지 업로드 테스트
- ✅ 회사 로고 업로드 테스트
- ✅ 5개 테마 카드에서 이미지 표시 확인
- ✅ 관리자 권한으로 다른 사용자 명함 수정 테스트
- ✅ RLS 정책 검증 (일반 사용자 vs 관리자)

## 알려진 이슈

### 해결됨
- ✅ 관리자 RLS 정책 누락 → 정책 추가로 해결
- ✅ Storage RLS 정책 누락 → 관리자 정책 추가로 해결

### 미해결
- 없음

## 다음 단계 (v2.5 예정)

### Week 4: 명함 생성 기능
- CardCreateModal 컴포넌트 구현
- 사용자 검색 및 선택
- 모든 필드 입력 지원
- 프로필 이미지 업로드

### Week 5: 부가명함 관리
- 부가명함 목록 페이지
- 부가명함 편집/삭제
- 카테고리별 필터링
- 이미지 업로드 관리

## 기여자

- **PM/Tech Lead**: 개발 및 기획
- **Backend**: Supabase 스키마 및 RLS 정책
- **Frontend**: React 컴포넌트 및 UI

## 관련 링크

- [GitHub Commit](https://github.com/inervetdev/g-plat/commit/a57f10c)
- [PRD 문서](../../../prd.md)
- [현재 Phase](../../roadmap/current-phase.md)
- [Admin 서비스 스펙](../../../ADMIN_SERVICE_SPECIFICATION.md)
