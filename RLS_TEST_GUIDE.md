# RLS 활성화 후 테스트 가이드

개발 서버: **http://localhost:5173**

---

## 🔐 테스트 1: 로그인 & 인증

### 시나리오 1-1: 정상 로그인
1. **http://localhost:5173/login** 접속
2. 기존 계정으로 로그인 시도
   - 이메일 입력
   - 비밀번호 입력
   - "로그인" 버튼 클릭
3. **예상 결과**:
   - ✅ 대시보드(/dashboard)로 리다이렉트
   - ✅ 사용자 정보 표시
   - ✅ 명함 목록 조회 가능

### 시나리오 1-2: 로그인 없이 보호된 페이지 접근
1. 브라우저 시크릿 모드 열기
2. **http://localhost:5173/dashboard** 직접 접속
3. **예상 결과**:
   - ✅ 로그인 페이지로 리다이렉트
   - ⚠️ 만약 접근된다면 RLS 정책 오류

### 시나리오 1-3: 로그아웃 후 재접근
1. 로그인 상태에서 로그아웃
2. 브라우저 뒤로가기로 대시보드 접근 시도
3. **예상 결과**:
   - ✅ 다시 로그인 페이지로 리다이렉트

---

## 📇 테스트 2: 명함 생성 (250930 이슈 확인)

### 시나리오 2-1: 새 명함 생성
1. 로그인 후 대시보드 접속
2. "명함 생성" 또는 "Create Card" 버튼 클릭
3. 명함 정보 입력:
   ```
   이름: 테스트 사용자
   직함: 시니어 개발자
   회사: 지플랫
   전화번호: 010-1234-5678
   이메일: test@example.com
   주소: 서울시 강남구
   커스텀 URL: test-user-001
   ```
4. "생성 완료" 버튼 클릭
5. **예상 결과**:
   - ✅ "명함 생성 중 오류가 발생했습니다" 메시지가 나오지 않아야 함
   - ✅ 대시보드로 리다이렉트
   - ✅ 생성된 명함이 목록에 표시

### 🔍 250930 이슈 확인 포인트
- ❌ 이전: "명함 생성 중 오류가 발생했습니다" 에러
- ✅ 해결: RLS 정책이 올바르게 적용되어 생성 성공

### 디버깅 정보 (에러 발생 시)
- 브라우저 콘솔(F12) 확인
- 에러 메시지 캡처
- Network 탭에서 API 응답 확인

---

## 💼 테스트 3: 부업 카드 생성 (CTA 링크 오류 확인)

### 시나리오 3-1: 부업 카드 생성
1. 로그인 후 **http://localhost:5173/sidejob-cards** 접속
2. "부업 카드 추가" 버튼 클릭
3. 부업 카드 정보 입력:
   ```
   제목: AI 컨설팅 서비스
   설명: 기업 AI 도입 전문 컨설팅
   가격: 500,000원
   CTA 텍스트: 상담 신청하기
   CTA 링크: https://example.com/consult
   ```
4. "저장" 버튼 클릭
5. **예상 결과**:
   - ✅ "Could not find the 'cta_link' column" 에러가 나오지 않아야 함
   - ✅ 카드가 목록에 추가됨
   - ✅ CTA 버튼이 올바르게 표시

### 🔍 250930 이슈 확인 포인트
- ❌ 이전: "Could not find the 'cta_link' column of 'sidejob_cards'" 에러
- ✅ 해결: 컬럼이 존재하고 데이터가 정상 저장

### 시나리오 3-2: 부업 카드 수정
1. 생성된 카드의 "수정" 버튼 클릭
2. CTA 링크 변경: `https://example.com/new-link`
3. "저장" 클릭
4. **예상 결과**:
   - ✅ 수정 성공
   - ✅ 변경된 링크가 반영됨

### 시나리오 3-3: 활성/비활성 토글
1. 카드의 활성/비활성 스위치 클릭
2. **예상 결과**:
   - ✅ 즉시 상태 변경
   - ✅ 비활성 카드는 공개 조회에서 숨겨짐 (나중에 확인)

---

## 📱 테스트 4: QR 코드 기능

### 시나리오 4-1: QR 코드 생성
1. 대시보드에서 명함 선택
2. "QR 코드" 또는 "QR" 버튼 클릭
3. **http://localhost:5173/qr/:cardId** 페이지로 이동
4. **예상 결과**:
   - ✅ QR 코드 이미지가 표시됨
   - ✅ 단축 URL이 생성됨
   - ✅ 다운로드 버튼 작동

### 시나리오 4-2: QR 코드 다운로드
1. "다운로드" 버튼 클릭
2. **예상 결과**:
   - ✅ PNG 파일 다운로드
   - ✅ 파일명: `qr-code-{timestamp}.png`

### 시나리오 4-3: QR 통계 조회
1. QR 코드 페이지에서 "통계" 버튼 클릭
2. **예상 결과**:
   - ✅ 스캔 횟수 표시
   - ✅ 디바이스 분포 차트
   - ✅ 본인의 QR 통계만 조회됨

### 시나리오 4-4: 로그아웃 상태에서 QR 스캔 (중요!)
1. 로그아웃
2. 생성된 QR 코드를 스캔하거나 단축 URL 직접 접속
3. **예상 결과**:
   - ✅ 명함 페이지로 리다이렉트
   - ✅ 스캔 기록이 qr_scans 테이블에 저장됨
   - ⚠️ 로그인 요구되면 RLS 정책 오류

---

## 🔒 테스트 5: RLS 보안 테스트

### 시나리오 5-1: 다른 사용자 데이터 접근 시도
1. 계정 A로 로그인
2. 계정 A의 명함 ID 확인 (예: `card-uuid-111`)
3. 로그아웃 후 계정 B로 로그인
4. 계정 A의 명함 수정 URL 직접 접속:
   ```
   http://localhost:5173/edit-card/card-uuid-111
   ```
5. **예상 결과**:
   - ✅ 접근 거부 또는 404 에러
   - ✅ 데이터 조회/수정 불가
   - ⚠️ 만약 접근된다면 RLS 정책 오류

### 시나리오 5-2: 공개 명함 조회
1. 로그아웃 상태
2. 공개 명함 URL 접속:
   ```
   http://localhost:5173/card/{user_id 또는 custom_url}
   ```
3. **예상 결과**:
   - ✅ 명함 내용 조회 가능
   - ✅ 부업 카드 중 활성화된 것만 표시
   - ✅ 수정 버튼은 보이지 않아야 함

### 시나리오 5-3: 비활성 부업 카드 숨김 확인
1. 부업 카드 하나를 비활성화
2. 로그아웃 후 공개 명함 URL 접속
3. **예상 결과**:
   - ✅ 비활성 카드는 표시되지 않음
   - ✅ 활성 카드만 표시

---

## 📊 테스트 6: 통계 페이지

### 시나리오 6-1: 방문자 통계 조회
1. 로그인 후 **http://localhost:5173/stats** 접속
2. **예상 결과**:
   - ✅ 본인의 통계만 표시
   - ✅ 방문자 수, 조회수 등 메트릭 표시
   - ✅ 차트 렌더링 정상

### 시나리오 6-2: 대시보드 메트릭
1. **http://localhost:5173/dashboard** 접속
2. **예상 결과**:
   - ✅ 총 방문자, 명함 조회수 등 표시
   - ✅ 최근 활동 목록
   - ✅ 데이터 로딩 성공

---

## ✅ 테스트 체크리스트

### 인증 & 보안
- [ ] 로그인 성공
- [ ] 로그아웃 후 보호된 페이지 접근 차단
- [ ] 다른 사용자 데이터 접근 차단
- [ ] 공개 명함 조회 가능

### 명함 기능
- [ ] 명함 생성 성공 (250930 이슈 해결 확인)
- [ ] 명함 수정 성공
- [ ] 명함 삭제 성공
- [ ] 명함 목록 조회

### 부업 카드
- [ ] 부업 카드 생성 성공 (CTA 링크 오류 해결 확인)
- [ ] 부업 카드 수정 (CTA 링크 포함)
- [ ] 활성/비활성 토글
- [ ] 순서 변경 (드래그 앤 드롭)
- [ ] 비활성 카드 공개 조회에서 숨김

### QR 코드
- [ ] QR 코드 생성
- [ ] QR 코드 다운로드
- [ ] QR 통계 조회 (본인만)
- [ ] 로그아웃 상태에서 QR 스캔 작동

### 통계
- [ ] 방문자 통계 조회
- [ ] 대시보드 메트릭 표시
- [ ] 차트 렌더링

---

## 🚨 에러 발생 시 수집할 정보

1. **브라우저 콘솔 (F12 → Console)**
   - 에러 메시지 전체 복사
   - 스택 트레이스 확인

2. **Network 탭**
   - 실패한 API 요청 확인
   - Response 내용 확인
   - Status Code 확인

3. **Supabase 에러 코드**
   - `PGRST116`: RLS 정책 위반
   - `42501`: 권한 부족
   - `23505`: 중복 키 오류

4. **스크린샷**
   - 에러 발생 화면
   - 콘솔 에러 메시지
   - Network 응답

---

## 📝 테스트 결과 기록 양식

```
테스트 항목: [예: 명함 생성]
결과: [성공/실패]
에러 메시지: [있다면]
재현 방법: [단계별]
스크린샷: [issue/251001/ 폴더에 저장]
```

---

**테스트 시작 시간**: ___________
**테스트 완료 시간**: ___________
**발견된 이슈 수**: ___________

테스트 중 문제 발견 시 즉시 알려주세요!
